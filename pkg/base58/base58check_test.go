package base58_test

import (
	"testing"

	"github.com/greymass/go-eosio/internal/assert"
	"github.com/greymass/go-eosio/pkg/base58"
)

func TestDecodeCheck(t *testing.T) {
	var err error
	var res []byte

	res, err = base58.CheckDecode("5KQvfsPJ9YvGuVbLRLXVWPNubed6FWvV8yax6cNSJEzB4co3zFu")
	assert.NoError(t, err)
	assert.Equal(t, res, []byte{
		0x80, 0xd2, 0x59, 0x68, 0xeb, 0xfc, 0xe6, 0xe6, 0x17, 0xbd, 0xb8, 0x39, 0xb5, 0xa6, 0x6c, 0xfc, 0x1f,
		0xdd, 0x05, 0x1d, 0x79, 0xa9, 0x10, 0x94, 0xf7, 0xba, 0xce, 0xde, 0xd4, 0x49, 0xf8, 0x43, 0x33,
	})

	res, err = base58.CheckDecodeEosio("6RrvujLQN1x5Tacbep1KAk8zzKpSThAQXBCKYFfGUYeABhJRin", "")
	assert.NoError(t, err)
	assert.Equal(t, res, []byte{
		0x02, 0xca, 0xee, 0x1a, 0x02, 0x91, 0x0b, 0x18, 0xdf, 0xd5, 0xd9, 0xdb, 0x0e, 0x8a, 0x4b, 0xc9, 0xf,
		0x8d, 0xd3, 0x4c, 0xed, 0xbb, 0xfb, 0x00, 0xc6, 0xc8, 0x41, 0xa2, 0xab, 0xb2, 0xfa, 0x28, 0xcc,
	})

	res, err = base58.CheckDecodeEosio("6RrvujLQN1x5Tacbep1KAk8zzKpSThAQXBCKYFfGUYeACcSRFs", "K1")
	assert.NoError(t, err)
	assert.Equal(t, res, []byte{
		0x02, 0xca, 0xee, 0x1a, 0x02, 0x91, 0x0b, 0x18, 0xdf, 0xd5, 0xd9, 0xdb, 0x0e, 0x8a, 0x4b, 0xc9, 0xf,
		0x8d, 0xd3, 0x4c, 0xed, 0xbb, 0xfb, 0x00, 0xc6, 0xc8, 0x41, 0xa2, 0xab, 0xb2, 0xfa, 0x28, 0xcc,
	})

	_, err = base58.CheckDecodeEosio("6RrvujLQN1x5Tacbep1KAk8zzKpSThAQXBCKYFfGUYeACcSRFs", "ZZ")
	assert.HasError(t, &err)
}

func TestEncodeCheck(t *testing.T) {
	var res string

	res = base58.CheckEncode([]byte{
		0x80, 0xd2, 0x59, 0x68, 0xeb, 0xfc, 0xe6, 0xe6, 0x17, 0xbd, 0xb8, 0x39, 0xb5, 0xa6, 0x6c, 0xfc, 0x1f,
		0xdd, 0x05, 0x1d, 0x79, 0xa9, 0x10, 0x94, 0xf7, 0xba, 0xce, 0xde, 0xd4, 0x49, 0xf8, 0x43, 0x33,
	})
	assert.Equal(t, res, "5KQvfsPJ9YvGuVbLRLXVWPNubed6FWvV8yax6cNSJEzB4co3zFu")

	res = base58.CheckEncodeEosio([]byte{
		0x02, 0xca, 0xee, 0x1a, 0x02, 0x91, 0x0b, 0x18, 0xdf, 0xd5, 0xd9, 0xdb, 0x0e, 0x8a, 0x4b, 0xc9, 0xf,
		0x8d, 0xd3, 0x4c, 0xed, 0xbb, 0xfb, 0x00, 0xc6, 0xc8, 0x41, 0xa2, 0xab, 0xb2, 0xfa, 0x28, 0xcc,
	}, "")
	assert.Equal(t, res, "6RrvujLQN1x5Tacbep1KAk8zzKpSThAQXBCKYFfGUYeABhJRin")

	res = base58.CheckEncodeEosio([]byte{
		0x02, 0xca, 0xee, 0x1a, 0x02, 0x91, 0x0b, 0x18, 0xdf, 0xd5, 0xd9, 0xdb, 0x0e, 0x8a, 0x4b, 0xc9, 0xf,
		0x8d, 0xd3, 0x4c, 0xed, 0xbb, 0xfb, 0x00, 0xc6, 0xc8, 0x41, 0xa2, 0xab, 0xb2, 0xfa, 0x28, 0xcc,
	}, "K1")
	assert.Equal(t, res, "6RrvujLQN1x5Tacbep1KAk8zzKpSThAQXBCKYFfGUYeACcSRFs")
}
